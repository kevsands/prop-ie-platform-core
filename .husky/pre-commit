#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running enhanced security checks..."

# Verify package integrity
echo "ğŸ”’ Verifying package lock integrity..."
npm run verify-lockfile || { echo "âŒ Package lock verification failed"; exit 1; }

# Run security checks with security-focused ESLint rules
echo "ğŸ”’ Running security linting checks..."
npm run security-check || { echo "âŒ Security checks failed"; exit 1; }

# Check for suspicious packages
echo "ğŸ”’ Checking for suspicious packages..."
npm run postinstall || { echo "âš ï¸ Suspicious package check failed"; }

# Generate and validate SBOM 
echo "ğŸ”’ Generating and validating software bill of materials..."
npm run generate-sbom && npm run validate-sbom || { echo "âš ï¸ SBOM validation failed"; }

# Run standard lint-staged for other checks
echo "ğŸ” Running lint-staged checks..."
npx lint-staged || { echo "âŒ Lint checks failed"; exit 1; }

echo "âœ… All pre-commit checks passed!"